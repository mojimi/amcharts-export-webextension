function txtAnchorToAlign(e){return"middle"===e?"center":"start"===e?"left":"end"===e?"right":e}function eleFromStr(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function chartTextToHtml(e){const t=document.createElement("div");return t.setAttribute("style","position: absolute; top: 0"),e.containerDiv.appendChild(t),e.containerDiv.querySelectorAll("text").forEach(n=>{const o=document.createElement("div");t.appendChild(o),o.style.position="absolute",n.children.length>0?n.querySelectorAll("tspan").forEach(e=>{const t=document.createElement("p");t.innerHTML=e.innerHTML,t.style.margin=0,o.appendChild(t),t.style.height=e.getBoundingClientRect().height+"px"}):o.innerHTML=n.innerHTML;const a=n.getBoundingClientRect();let r,i;o.style.whiteSpace="nowrap",o.style.fontSize=n.getAttribute("font-size"),o.style.color=n.getAttribute("fill"),o.style.textAlign=txtAnchorToAlign(n.getAttribute("text-anchor")),n.getAttribute("transform").includes("rotate")?(o.style.transform="rotate(270deg)",r=a.y-a.width/4-e.containerDiv.getBoundingClientRect().y+3,i=a.x-e.containerDiv.getBoundingClientRect().x+1):(r=a.y-a.height/4-e.containerDiv.getBoundingClientRect().y+3,i=a.x-e.containerDiv.getBoundingClientRect().x+1),o.style.top=r+"px",o.style.left=i+"px",n.style.visibility="hidden"}),t}function svgToCanvas(e,t=1){const n=document.createElement("canvas"),o=e.getBoundingClientRect();return n.width=o.width*t,n.height=o.height*t,e.setAttribute("style",""),e.setAttribute("viewBox","0 0 "+o.width+" "+o.height),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),canvg(n,e.outerHTML),n}function downloadCanvas(e){const t=document.createElement("a");t.setAttribute("href",e.toDataURL("image/png",1)),t.download="image.png",document.body.appendChild(t),t.click(),t.remove()}function loadJS(e){return new Promise(t=>{const n=document.createElement("script");n.onload=t,n.src=e,document.body.appendChild(n)})}function loadAmChartsExportMenu(){const e={en:{fontSize:"Text font size",fontColor:"Text color",exportButton:"Export",radius:"Pie size",angle:"Pie rotation",maxLabelWidth:"Max label width",labelRadius:"Label distance",chart:"Chart",legend:"Legend",customize:"Customize",horizontalMargin:"Horizontal Margin",legendPosition:"Position",top:"Top",bottom:"Bottom",left:"Left",right:"Right",enable:"Enabled",verticalMargin:"Vertical Margin"},"pt-BR":{fontSize:"Tamanho do texto",fontColor:"Cor do texto",exportButton:"Exportar",radius:"Tamanho do círculo",angle:"Rotação do círculo",maxLabelWidth:"Largura máxima dos rótulos",labelRadius:"Distância dos rótulos",chart:"Gráfico",legend:"Legenda",customize:"Customizar",horizontalMargin:"Margem horizontal",legendPosition:"Posição da legenda",top:"Em cima",bottom:"Embaixo",left:"Esquerda",right:"Direita",enable:"Habilitado",verticalMargin:"Margem vertical"}};let t=e[navigator.language];t||(t=e.en),AmCharts.charts.forEach((e,n)=>{const o=e.containerDiv.parentElement.parentElement.parentElement,a=eleFromStr('<button class="side-menu-button" style="position: absolute;top: 0;right: 0;padding: .3rem;cursor: pointer;border-radius: 50%;border: none;background: transparent;color: inherit;font-size: 2rem;margin-right: .5rem;transition: .2s ease;">\n            ☰\n        </button>'),r=eleFromStr(`<div class="side-menu-drawer" style="border-left: 1px solid lightgray;position: absolute;width: 300px;height: 100%;top: 0;right: 0;background: inherit; color : inherit;transform: translateX(100%);transform-origin: right;transition: .5s ease;padding: 1.5rem; max-width : 100%; overflow : auto">\n            <a class="side-menu-close">&times</a>\n            <h3 style="margin-bottom: 1rem;text-align: center;">${t.customize}</h3>\n        </div>`),i=eleFromStr('<div class="chart-options-div"></div>'),l=eleFromStr(`<input type="range" min="8" max="50" value="${e.fontSize}">`);l.oninput=(t=>{const n=Number(l.value);e.fontSize=n,e.graphs&&e.graphs.length>0&&e.graphs.forEach(e=>e.fontSize=n),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.fontSize}</label>`),i.insertAdjacentElement("beforeend",l);const s=eleFromStr(`<input style="margin-bottom : 1rem" type="color" value="${e.color}">`);let d=null;if(s.oninput=(t=>{clearTimeout(d),d=setTimeout(()=>{e.color=s.value,e.validateNow()},350)}),i.insertAdjacentHTML("beforeend",`<label>${t.fontColor}</label>`),i.insertAdjacentElement("beforeend",s),"pie"===e.type){const n=eleFromStr(`<input type="range" step="5" min="50" value="${e.radiusReal||200}" max="${2*e.radiusReal||350}">`);n.oninput=(t=>{e.radius=Number(n.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.radius}</label>`),i.insertAdjacentElement("beforeend",n);const o=eleFromStr(`<input type="range" step="10" min="0" value="${e.startAngle||90}" max="360">`);o.oninput=(t=>{e.startAngle=Number(o.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.angle}</label>`),i.insertAdjacentElement("beforeend",o);const a=eleFromStr(`<input type="range" step="5" min="50" value="${e.maxLabelWidth||100}" max="250">`);a.oninput=(t=>{e.maxLabelWidth=Number(a.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.maxLabelWidth}</label>`),i.insertAdjacentElement("beforeend",a);const r=eleFromStr(`<input type="range" step="1" min="-100" value="${e.labelRadius||20}" max="300">`);r.oninput=(t=>{e.labelRadius=Number(r.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.labelRadius}</label>`),i.insertAdjacentElement("beforeend",r)}else if("serial"===e.type){const n=eleFromStr(`<input style="margin-bottom : 1rem" value="${e.marginLeft}" step="10" type="range" min="0" max="500" value="0">`);n.oninput=(t=>{e.autoMargins=!1,e.marginRight=Number(n.value),e.marginLeft=Number(n.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.horizontalMargin}</label>`),i.insertAdjacentElement("beforeend",n);const o=eleFromStr(`<input style="margin-bottom : 1rem" value="${e.marginBottom}" step="10" type="range" min="0" max="400" value="0">`);o.oninput=(t=>{e.autoMargins=!1,e.marginTop=Number(o.value),e.marginBottom=Number(o.value),e.validateNow()}),i.insertAdjacentHTML("beforeend",`<label>${t.verticalMargin}</label>`),i.insertAdjacentElement("beforeend",o)}if(e.legend){const o=eleFromStr('<div hidden class="legend-options-div"></div>'),a=eleFromStr(`<input style="float: right" id="legend-enable-${n}" checked="true" type="checkbox">`);a.onchange=(t=>{[...a.parentElement.children].forEach(e=>{a.isSameNode(e)||(a.checked?e.removeAttribute("disabled"):e.setAttribute("disabled",!0))}),e.legend.enabled=a.checked,e.validateNow()}),o.insertAdjacentHTML("beforeend",`<label for="legend-enable-${n}" style="display : inline-block">${t.enable}</label>`),o.insertAdjacentElement("beforeend",a);const l=eleFromStr(`<input type="range" min="8" max="50" value="${e.legend.fontSize||e.fontSize}">`);l.oninput=(t=>{e.legend.fontSize=Number(l.value),e.validateNow()}),o.insertAdjacentHTML("beforeend",`<label>${t.fontSize}</label>`),o.insertAdjacentElement("beforeend",l);const s=eleFromStr(`<input style="margin-bottom : 1rem" type="color" value="${e.legend.color}">`);let d=null;s.oninput=(t=>{clearTimeout(d),d=setTimeout(()=>{e.legend.color=s.value,e.validateNow()},350)}),o.insertAdjacentHTML("beforeend",`<label>${t.fontColor}</label>`),o.insertAdjacentElement("beforeend",s);const m=eleFromStr(`<input style="margin-bottom : 1rem" "${e.legend.marginRight}" step="10" type="range" min="0" max="500" value="0">`);m.oninput=(t=>{e.legend.autoMargins=!1,"right"===e.legend.position?(e.legend.marginRight=Number(m.value),e.legend.marginLeft=0):"left"===e.legend.position?(e.legend.marginRight=0,e.legend.marginLeft=Number(m.value)):(e.legend.marginRight=Number(m.value),e.legend.marginLeft=Number(m.value)),e.validateNow()}),o.insertAdjacentHTML("beforeend",`<label>${t.horizontalMargin}</label>`),o.insertAdjacentElement("beforeend",m);const c=eleFromStr(`<select style="margin-bottom : 1rem">\n                <option ${"bottom"===e.legend.position?"selected":""} value="bottom">${t.bottom}</option>\n                <option ${"top"===e.legend.position?"selected":""} value="top">${t.top}</option>\n                <option ${"left"===e.legend.position?"selected":""} value="left">${t.left}</option>\n                <option ${"right"===e.legend.position?"selected":""} value="right">${t.right}</option>\n            `);c.onchange=(t=>{const n=c.value;"right"===n?(e.legend.marginRight=Math.max(e.legend.marginRight,e.legend.marginLeft),e.legend.marginLeft=0):"left"===n&&(e.legend.marginLeft=Math.max(e.legend.marginRight,e.legend.marginLeft),e.legend.marginRight=0),e.legend.position=n,e.validateNow()}),o.insertAdjacentHTML("beforeend",`<label>${t.legendPosition}</label>`),o.insertAdjacentElement("beforeend",c);const g=eleFromStr(`<input type="range" step="5" min="50" value="${e.legend.labelWidth||100}" max="250">`);g.oninput=(t=>{e.legend.labelWidth=g.value,e.validateNow()}),o.insertAdjacentHTML("beforeend",`<label>${t.maxLabelWidth}</label>`),o.insertAdjacentElement("beforeend",g);const u=eleFromStr(`<div class="mode-switch-div">\n                    <input hidden type="radio" name="switch-radios-${n}" id="chart-radio-${n}" checked="true">\n                    <label for="chart-radio-${n}">${t.chart}</label>\n                    <input hidden type="radio" name="switch-radios-${n}" id="legend-radio-${n}">\n                    <label for="legend-radio-${n}">${t.legend}</label>\n                </div>`),b=u.querySelector(`#chart-radio-${n}`),h=u.querySelector(`#legend-radio-${n}`);b.onchange=(e=>{o.hidden=!0,i.hidden=!1}),h.onchange=(e=>{o.hidden=!1,i.hidden=!0}),r.insertAdjacentElement("beforeend",u),r.insertAdjacentElement("beforeend",o)}r.insertAdjacentElement("beforeend",i),r.querySelectorAll('input[type="range"]').forEach(e=>{e.onmousedown=(t=>e.parentElement.parentElement.style.opacity="0.35"),e.onmouseup=(t=>e.parentElement.parentElement.style.opacity="1")});const m=eleFromStr(`<button style="width: 100%;margin-top: 2rem;border: 1px solid lightgray;padding: .5rem;background: white;cursor: pointer;" class="export-btn">${t.exportButton}</button>`);m.onclick=(t=>{a.style.visibility="visible",r.style.transform="translateX(100%)",amChartToCanvas(e,3.25).then(downloadCanvas)}),r.insertAdjacentElement("beforeend",m),r.querySelector(".side-menu-close").onclick=(e=>{a.style.visibility="visible",r.style.transform="translateX(100%)"}),a.onclick=(e=>{a.style.visibility="hidden",r.style.transform="translateX(0px)"}),o.appendChild(a),o.appendChild(r)}),console.log("Dashboard Charts to Image loaded!")}function amChartToCanvas(e,t){const n={backgroundColor:null,scale:t,useCORS:!0,allowTaint:!1,onclone:e=>{const n=e.querySelector('[html2canvas-current-div="true"]');n.querySelectorAll("*").forEach(e=>{e.style.backgroundColor="transparent"}),n.style.backgroundColor="transparent",n.querySelectorAll('[class*="amcharts-scrollbar"]').forEach(e=>e.remove()),n.querySelectorAll("svg").forEach(e=>{const n=e.parentElement,o=svgToCanvas(e,t);o.setAttribute("style",`transform: scale(${1/t}, ${1/t});transform-origin: top left`),e.replaceWith(o),n.style.overflow="visible",o.style.overflow="visible"})}},o=e.containerDiv;document.querySelectorAll('[html2canvas-current-div="true"]').forEach(e=>e.removeAttribute("html2canvas-current-div")),o.setAttribute("html2canvas-current-div","true");const a=chartTextToHtml(e);return html2canvas(o,n).then(t=>{a.remove(),e.containerDiv.querySelectorAll("text").forEach(e=>e.style.visibility="visible");const n=t.getContext("2d");return n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,t})}loadJS("https://raw.githack.com/mojimi/string-format/master/html2canva.test.js").then(()=>loadJS("https://raw.githack.com/mojimi/string-format/master/rgbcolor.test.js")).then(()=>loadJS("https://raw.githack.com/mojimi/string-format/master/canvg2.test.js")).then(()=>loadJS("https://raw.githack.com/amcharts/amcharts3/master/amcharts/plugins/export/export.min.js")).then(loadAmChartsExportMenu);
